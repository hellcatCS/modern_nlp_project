# Design-Doc: Telegram-бот для автоматизации коммуникации ресторана

------------------------------------------------------------------------

# 1. Контекст проекта

## 1.1 Бизнес-задача

### Проблема

Ресторан получает значительное количество входящих обращений:

-   вопросы по меню
-   уточнение состава блюд
-   бронирование / перенос / отмена столов
-   уточнение режима работы
-   запросы на проведение мероприятий
-   сбор отзывов

В часы пик менеджеры не успевают оперативно отвечать, что приводит к:

-   потере потенциальных бронирований
-   снижению качества сервиса
-   фрагментированной коммуникации
-   отсутствию системной аналитики по обращениям

### Предлагаемое решение

Разработка Telegram-бота, который:

-   работает от имени аккаунта менеджера
-   полностью имитирует живую коммуникацию
-   использует единый универсальный промпт
-   подключён к системе бронирования
-   использует RAG по внутренним документам ресторана

Бот не позиционируется как «бот» для пользователя --- коммуникация
выглядит как диалог с менеджером.

### Почему без чат-бота не обойтись

-   Мессенджеры --- основной канал коммуникации
-   Ожидание мгновенного ответа
-   Человеческий ресурс не масштабируется
-   Конкуренты уже используют автоматизацию

### Критерии успеха

В продакшене измеряются:

1.  Количество успешных бронирований
2.  Конверсия в бронирование (сравнение с коммуникацией живого
    менеджера)
3.  Пользовательский рейтинг взаимодействия

Отдельно (оффлайн):

-   \% корректных ответов на FAQ
-   \% корректных сценариев бронирования / отмен
-   Прохождение тест-кейсов

------------------------------------------------------------------------

## 1.2 Целевая аудитория

**Основные пользователи:**

-   Клиенты ресторана (Telegram)

**Интерфейс:**

-   Telegram-чат
-   Общение от имени аккаунта человека
-   Без отдельного UI

**Нагрузка (оценка):**

-   50--300 диалогов в день (MVP)
-   Пиковые часы: 18:00--22:00

**Цена ошибки:**

-   Некорректная бронь → прямой финансовый ущерб
-   Ошибка в составе блюда → репутационные риски

------------------------------------------------------------------------

## 1.3 Ограничения и допущения

### Ограничения

-   Один универсальный промпт для всех сценариев
-   Нет отдельной сценарной логики на уровне кода
-   Нет fine-tuning модели
-   Нет уведомления пользователю при переключении на менеджера

### Эскалация

Если модель:

-   не уверена
-   не понимает контекст
-   сталкивается с нестандартным кейсом

диалог бесшовно передаётся менеджеру без уведомления пользователя.

### Репутационные риски

-   Галлюцинации
-   Неверные детали бронирования
-   Неправильный тон

Mitigation:

-   Строгий системный промпт
-   RAG с ограничением источников
-   Логирование всех диалогов

------------------------------------------------------------------------

# 2. Архитектура решения

## 2.1 Общая схема

Telegram → Backend API → RAG Retrieval → LLM → Ответ → (при
необходимости) API системы бронирования

При низкой уверенности --- передача менеджеру.

**Компоненты:**

1.  Telegram Bot API
2.  Backend (FastAPI)
3.  Векторная база
4.  LLM API
5.  Система бронирования
6.  База хранения диалогов

------------------------------------------------------------------------

## 2.2 Хранилище знаний

### Источники

-   Меню (PDF / Excel)
-   FAQ
-   Политики ресторана
-   Акции и события

### Предобработка

-   Парсинг
-   Очистка
-   Разбиение на чанки (300--500 токенов)
-   Добавление метаданных (тип, дата обновления)

### Векторизация

Рекомендуемые модели:

-   DeepPavlov/rubert-base-cased-sentence
-   sentence-transformers/paraphrase-multilingual-mpnet-base-v2

Метрика: cosine similarity.

### Обновление

-   Ручное обновление при изменении меню
-   Пересборка индекса при крупных изменениях
-   Хранение в векторной БД (например, Qdrant)

------------------------------------------------------------------------

# 2.4 Инфраструктура

### Архитектурный стек

-   Docker Swarm
-   Один выделенный сервер

Два контура:

-   dev
-   prod

### Логирование

-   Elastic
-   Kibana

### Мониторинг

-   Grafana
-   Метрики latency
-   Количество запросов
-   Ошибки

### Вычисления

-   CPU (при использовании API LLM)
-   GPU не требуется

------------------------------------------------------------------------

# 3. Данные и качество знаний

## 3.1 Чувствительные данные

Обрабатываются:

-   Имя клиента
-   Телефон
-   Дата и время бронирования

Требования:

-   Хранение только необходимых данных
-   Шифрование
-   Соответствие GDPR

------------------------------------------------------------------------

## 3.3 Метрики качества

### Оффлайн

-   Accuracy ответов на FAQ
-   \% корректных бронирований
-   Прохождение тестовых сценариев

### Онлайн

-   Конверсия в бронирование
-   Пользовательский рейтинг
-   Доля эскалаций менеджеру

------------------------------------------------------------------------

# 4. Модель и генерация

## 4.1 LLM

Выбирается модель:

-   Поддерживающая русский язык
-   Стабильная в диалогах
-   С низкой латентностью

Промпт включает:

-   Роль (менеджер ресторана)
-   Тон общения
-   Ограничение области знаний
-   Инструкции не выходить за рамки компетенции
-   Использование только данных из RAG

Один универсальный промпт покрывает:

-   FAQ
-   Бронирование
-   Отмену
-   Сбор отзывов

------------------------------------------------------------------------

## 4.2 Контроль качества

Так как fine-tuning не планируется:

-   Качество регулируется промптом
-   Используется RAG
-   Используется логирование и ручной анализ

Fallback:

-   При нестандартной ситуации --- передача менеджеру

------------------------------------------------------------------------

# 7. План внедрения

### Фаза 0 --- Сбор документов

### Фаза 1 --- MVP (FAQ + бронирование)

### Фаза 2 --- Интеграция с системой бронирования

### Фаза 3 --- Оптимизация и масштабирование

------------------------------------------------------------------------

# 8. Риски

  -----------------------------------------------------------------------------
  Риск                       Вероятность   Влияние   Mitigation
  -------------------------- ------------- --------- --------------------------
  Галлюцинации               Средняя       Высокое   RAG + строгий промпт

  Ошибка брони               Низкая        Высокое   Подтверждение данных

  Неполное понимание запроса Средняя       Среднее   Эскалация
  -----------------------------------------------------------------------------

------------------------------------------------------------------------

# 9. Бюджет

**Команда:**

-   Backend-разработчик
-   ML-инженер
-   DevOps

**OPEX:**

-   LLM API
-   Сервер
-   Поддержка

**ROI:**

-   Повышение конверсии
-   Снижение нагрузки
-   Масштабирование решения на другие рестораны
